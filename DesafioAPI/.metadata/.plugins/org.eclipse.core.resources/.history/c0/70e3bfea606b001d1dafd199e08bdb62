package com.gft.services;

import java.util.ArrayList;
import java.util.List;
import java.util.Optional;
import java.util.stream.Collectors;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.gft.dto.CriarUsuarioPerfil;
import com.gft.entities.Perfil;
import com.gft.entities.Usuario;
import com.gft.repositories.UsuarioRepository;

@Service
public class CriarUsuarioPerfilService {

	@Autowired
	UsuarioRepository usuarioRepository;
	
	public Usuario salvarUsuarioPerfil(CriarUsuarioPerfil criarUsuarioPerfil) {
		Optional<Usuario> usuarioExiste = usuarioRepository.findById(criarUsuarioPerfil.getIdUser());
		List<Perfil> perfis = new ArrayList<>();
		
		if(usuarioExiste.isEmpty()) {
			throw new Error ("Usuario nÃ£o existe!");
		}
		
		perfis = criarUsuarioPerfil.getIdRoles().stream().map(perfil->{
			return new Perfil(perfil);
		}).collect(Collectors.toList());
		
		Usuario usuario = usuarioExiste.get();
		
		usuario.setPerfil(perfis);
		
		usuarioRepository.save(usuario);
		
		return usuario;
	}
}
